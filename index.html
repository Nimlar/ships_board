<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">

    <title>snap svg</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
<style type="text/css">
            html, body {
                height: 100%;
            }
            #svg {
                width: 100%;
                height: 100%;
                border: solid 0px ;
                margin: 0 0;
                padding: 0 0;
               /* background:url("space.jpg")  repeat;*/
            }
        </style>
  </head>
  <body >
  <svg id="svg">
  <defs></defs>
  </svg>
<script type="text/javascript" src="snap.svg-min.js"></script>
<script>

function move()
{
    var width = document.getElementById('svg').offsetWidth;
    var height = document.getElementById('svg').offsetHeight;
    //console.log(JSON.stringify(this), ["img"], 4);
    var x0=this.prev[0]*width;
    var y0=this.prev[1]*height;
    var x1=this.pos[0]*width;
    var y1=this.pos[1]*height;

    var angle=Snap.angle(x1,y1,x0,y0);
    var t=new Snap.Matrix();
    t.translate(x1, y1);
    t.rotate(angle,0,0);
    this.img.animate({transform :t}, 1000);
}


var s = Snap("#svg");
_ships=[{ pos : [0  ,0    ],     prev :[.2  ,.3  ], color: "yellow", move:move},
        { pos : [.5  ,.5  ],     prev :[.2  ,.3  ], color: "red", move:move},
        { pos : [.4  ,.5  ],     prev :[.2  ,.3  ], color: "green", move:move},
        { pos : [.001,0.83],     prev :[.2  ,.3  ], color: "blue", move:move},
        { pos : [.03 ,.83 ],     prev :[.2  ,.3  ], color: "gray", move:move}
       ];
//ships=_ships;
      ships=[_ships[1]];
//      ships=[_ships[0],_ships[1]];

planets=[{ pos : [.1  ,.3  ], size:10},
         { pos : [.3  ,.1  ], size:10},
         { pos : [.9  ,.7  ], size:10},
         { pos : [.7  ,.9  ], size:10},
         { pos : [.5  ,.5  ], size:10},
         { pos : [.78  ,.86  ], size:10},
         { pos : [.14  ,.23  ], size:10},
         { pos : [.36  ,.48  ], size:10},
         ];
var width = document.getElementById('svg').offsetWidth;
var height = document.getElementById('svg').offsetHeight;

for(i=0;i<planets.length;i++){
    planets[i].img=s.circle(planets[i].pos[0]*width, planets[i].pos[1]*height, planets[i].size*(Math.random()+.5));
    planets[i].img.attr({
        fill: "#bada55",
        stroke: "#000",
        strokeWidth: i
    });
}
function move_ship(ship)
{
    var t=new Snap.Matrix();
    if (ship.img === undefined) {
        Snap.load("fleche.svg", function(e) {
            var f=e.select("g"); /* get the internal data of svg */
            f.select("#center").attr({fill: this.color});
            s.append(f);
            this.img=f;
            this.move();
        }, ship);
    } else {
        ship.move()
    }
}

function move_all(){
    for(i=0;i<ships.length;i++){
        ships[i].prev[0]=ships[i].pos[0]
        ships[i].prev[1]=ships[i].pos[1]
        var dest = planets[Math.floor((Math.random() * planets.length))];
        ships[i].planet=dest;
        ships[i].pos[0]=dest.pos[0]-(dest.size/width);
        ships[i].pos[1]=dest.pos[1]-(dest.size/height);
        move_ship(ships[i]);

    }
}
function event_one(){
    var width = document.getElementById('svg').offsetWidth;
    var height = document.getElementById('svg').offsetHeight;

    var ship = ships[Math.floor((Math.random() * ships.length))]
    var sText = s.text(0, 0, Math.floor((Math.random() * 2000))).attr({ fontSize: '100px', "text-anchor": "middle", "fill": ship.color });

    /* create the path to follow while animation */
    var p1x,p1y,cx,cy,p2x,p2y;
    var dx, dy;
    p1x=ship.planet.pos[0]*width;
    p1y=ship.planet.pos[1]*height;
    var bbox=ship.img.getBBox();
    p2x=bbox.cx;
    p2y=bbox.cy;

    /* normal calculation : http://stackoverflow.com/questions/1243614/how-do-i-calculate-the-normal-vector-of-a-line-segment */
    dx=p2x-p1x;
    dy=p2y-p1y;
    /* normal vectors are (dy, -dx) and  (-dy, dx) */
    /* we want the one that go up, so with an y component <=0 */
    if(dx>=0) {
        dx=-dx;
    } else {
        dy=-dy;
    }
    /* the normal vector is the same size as p1 to p2, we want it 4 times bigger so*/
    cx=p1x+dx/2+ dy* 4
    cy=p1y+dy/2+ dx* 4

//    var t=s.path("M"+p1x+","+p1y +" Q"+ cx +","+ cy +","+ p2x +","+p2y)
//    s.append(t);
    pathStr="M"+ship.planet.pos[0]*width +"," + ship.planet.pos[1]*height +"q10,10,10,10"
    var timing = 800;
    Snap.animate( 0, 2, function( value ) {
        var dot = Snap.path.findDotsAtSegment(p1x,p1y,cx,cy,cx,cy,p2x,p2y,value/2);
        sText.transform('t'+ dot.x +',' + dot.y );
        if (value <1) {
            sText.attr({ 'font-size': value * 10 +10 });      // Animate by font-size
        } else {
            sText.attr({ 'font-size': (2-value) * 10 +10});      // Animate by font-size
        }
    }, timing, mina.elactic, function() { sText.remove() } );

}

move_all();
//event_one();
</script>
  <input type="button" value="move" onclick="move_all();"/>
  <input type="button" value="event" onclick="event_one();"/>
  </body>
</html>
